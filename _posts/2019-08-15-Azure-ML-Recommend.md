---
layout: post
title: Ne izleyelim? - Azure Machine Learning Studio
comments: true
redirect_from: "/2019/08/15/Azure-ML-Recommend/"
permalink: azure-ml-recommend
---

Hangi filmi izlesem, seveceƒüim yeni bir dizi olsa da ba≈ülasam diyor musunuz? [imdb.com](http://imdb.com) √ºzerinde izlediƒüiniz film ve dizilere puan veriyor musunuz? Haydi o zaman Azure Machine Learning Studio (kƒ±saca Azure ML diyeceƒüim) ile yeni tavsiyeler yaptƒ±ralƒ±m.

## Puanlarƒ±mƒ±zƒ± indirelim

[imdb.com](http://imdb.com) adresinden verdiƒüimiz puanlara gidelim (umarƒ±m link g√∂r√ºlebiliyordur üòÄ).

![Puanlar](/assets/azure-ml-recommend-ratings.jpg)

Puanlarƒ±mƒ±zƒ± .csv dosyasƒ± olarak indirelim.

![Export](/assets/azure-ml-recommend-export.jpg)

A≈üaƒüƒ±daki gibi bir i√ßeriƒüi olan dosyamƒ±zƒ± bir kenara kaldƒ±ralƒ±m.

![Csv](/assets/azure-ml-recommend-csv.jpg)

Ben 2007 yƒ±lƒ±ndan bu g√ºne 1611 dizi ve filme oy vermi≈üim, tabi 2007 √∂ncesi izlediklerimi de hatƒ±rlayƒ±p olabildiƒüince izlediƒüim her ≈üeye puan vermeye √ßalƒ±≈üƒ±yorum (ve biraz fazla izliyor olabilirim).

Gerekiyorsa √ºye olup en azƒ±ndan 100 civarƒ± oy vermeye √ßalƒ±≈ümanƒ±zƒ± tavsiye ederim.

## Azure ML

[Azure ML](https://studio.azureml.net) adresinden giri≈ü yapalƒ±m, eƒüer √ºye deƒüilseniz **Free Workspace** ile √ºcretsiz giri≈ü yapabilirsiniz (10 GB limit oluyor). A≈üaƒüƒ±daki gibi bir ekran ile kar≈üƒ±la≈ümanƒ±z gerekiyor.

![Main](/assets/azure-ml-recommend-main.jpg)

Sol altta yer alan **New** butonu ile yeni bir deney olu≈üturalƒ±m.

![New Experiment](/assets/azure-ml-recommend-new.jpg)

Bizi a≈üaƒüƒ±daki gibi bir ekran kar≈üƒ±layacak.

![New Experiment](/assets/azure-ml-recommend-experiment.jpg)

Ben ilk i≈ü sol √ºstte g√∂rd√ºƒü√ºn√ºz tarih yerine akƒ±lda kalacak bir isim veriyorum, tavsiye ederim √ßok karƒ±≈üƒ±yor yoksa.

Yine **New** butonu ile indirdiƒüimiz puanlarƒ±mƒ±zƒ± **Dataset** olarak y√ºkleyelim.

![New Dataset](/assets/azure-ml-recommend-new-dataset.jpg)

Y√ºkleme tamamlandƒ±ƒüƒ±nda **Dataset** **Saved Datasets** men√ºs√ºnde **My Datasets** altƒ±na gelecek, s√ºr√ºkleyip ortalƒ±ƒüa bƒ±rakalƒ±m.

![Dataset](/assets/azure-ml-recommend-dataset.jpg)

## Dataset

Dataset; ayrƒ±lmƒ±≈ü, json, excel, parquet, pandas DataFrame, SQL sorgusu ve binary formatlarƒ±nƒ± destekleyen **veriyi temsil eden** bir yapƒ±. Basit√ße verileri temsil eden ortak format gibi g√∂rebilirsiniz. Bir Dataset olu≈üturduƒüumuzda veriye nasƒ±l ula≈üƒ±lacaƒüƒ± bilgisi ve kaynaƒüƒ±n meta bilgisi kopyalanƒ±r, veriler kopyalanmaz. Veri esas kaynaƒüƒ±nda durur, gerektiƒüinde yorumlanarak okunur b√∂ylece ekstra saklama alanƒ± harcanmaz.

Eklediƒüimiz puanlarƒ±mƒ±za saƒü tƒ±klayƒ±p **Visualize** diyerek i√ßeriƒüi g√∂rebilirsiniz.

![Dataset Visualize](/assets/azure-ml-recommend-dataset-visualize.jpg)

![Ratings Visualize](/assets/azure-ml-recommend-ratings-visualize.jpg)

Azure ML bize bir √ßok hazƒ±r Dataset'de saƒülƒ±yor, bunlardan bir tanesi hazƒ±r film puanlarƒ±. Zaten bu olmasa veri toplamakla da uƒüra≈ümamƒ±z gerekecekti. Azure bize 227.472 adet hazƒ±r puan bilgisini sunuyor. Hemen deneyimize ekleyelim.

![Movie Ratings](/assets/azure-ml-recommend-movie-ratings.jpg)

ƒ∞sterseniz i√ßeriƒüine yine aynƒ± ≈üekilde Visualize se√ßeneƒüiyle bakabilirsiniz. Hatta bakƒ±n, gƒ±cƒ±k bir durum var √ß√ºnk√º.

![Movie Ratings Visualize](/assets/azure-ml-recommend-movie-ratings-visualize.jpg)

**MovieId** alanƒ± sayƒ± tipinde, oysa bizim indirdiƒüimiz kendi oylarƒ±mƒ±zda **tt** ile ba≈ülayan ve **0** ile [padleft](https://qz.com/646467/how-one-programmer-broke-the-internet-by-deleting-a-tiny-piece-of-code/) yapƒ±lmƒ±≈ü durumda. Birini diƒüerine √ßevirmemiz gerekiyor.

Sol tarafta g√∂rd√ºƒü√ºn√ºz men√ºde veriler √ºzerinde bir √ßok i≈ülem yapmanƒ±zƒ± saƒülayan ara√ßlar bulunuyor. ƒ∞tiraf edeyim ben de bir √ßoƒüunu bilmiyorum, zaten √∂ƒürenme y√∂ntemi olarak bu t√ºr listeleri ezberlemeyi doƒüru bulmuyorum, ne yapmak istediƒüimizi biliyorsak neye ihtiyacƒ±mƒ±z olduƒüunu tahmin edebiliyoruz, ufak bir ara≈ütƒ±rma yaparak da gerekli aracƒ± hƒ±zlƒ±ca √∂ƒürenebiliyoruz. O y√ºzden hepsine deƒüinmektense kullandƒ±klarƒ±mƒ±zƒ± anlatacaƒüƒ±m sadece.

Veri d√∂n√º≈ü√ºm√º i√ßin benim favorim **Apply SQL Transformation** oldu. [SQLite](https://www.sqlite.org/index.html) sorgu motorunu kullanarak veriler √ºzerinde istediƒüimiz i≈ülemleri yapabiliyoruz. Bu arada [SQLite sorgu dili](https://www.sqlite.org/lang.html) biraz farklƒ±, **TSQL**, **PLSQL** yazƒ±p hayal kƒ±rƒ±klƒ±ƒüƒ±na uƒüramadan uyarayƒ±m dedim.

Arama kutusuna **sql** yazƒ±p **Apply SQL Transformation** kutusunu s√ºr√ºkleyip **ratings.csv** altƒ±na bƒ±rakalƒ±m ve √ºst soldaki noktayƒ± **ratings.csv** alt tarafƒ± ile baƒülayalƒ±m. Se√ßiliyken saƒü tarafta sorgumuzu girebileceƒüimiz bir kutu a√ßƒ±lacak. Bize sadece kullanƒ±cƒ± ID (kendimizi diƒüer kullanƒ±cƒ±lardan ayƒ±rmak i√ßin -1 veriyoruz), film ID ve oy bilgileri lazƒ±m. Tamamlanmƒ±≈ü hali a≈üaƒüƒ±daki gibi.

![SQL Transformation](/assets/azure-ml-recommend-sql.jpg)

≈ûimdi kendi oylarƒ±mƒ±zdan 3 alan se√ßerek yeni veri k√ºmemizi olu≈üturduk, bu listeye Azure ML tarafƒ±ndan bize sunulan listeyi de ekleyip kalabalƒ±k bir liste olu≈üturacaƒüƒ±z. Ancak bunun i√ßin √∂ncelikle s√ºtun sayƒ±larƒ±mƒ±zƒ±n e≈üit olmasƒ± gerekiyor. Sol taraftan √∂ncelikle **Select Columns in Dataset** bile≈üenini ekleyerek resimdeki gibi 3 alanƒ±mƒ±zƒ± se√ßelim.

![Select Rating Columns](/assets/azure-ml-recommend-rating-columns.jpg)

≈ûimdi kendi oylarƒ±mƒ±z ile hazƒ±r oylarƒ± birle≈ütirebiliriz. Burada dikkat edilmesi gereken bir nokta var, eƒüer verileri birle≈ütirmezseniz Azure ML bizim daha √∂nce verdiƒüimiz oylarƒ± tespit edemiyor, tavsiyeleri zaten izlediƒüimiz yapƒ±mlar oluyor (√ñrneƒüin bu birle≈ütirme i≈üini yapmadƒ±ƒüƒ±mda bana hazƒ±r veriler i√ßindeki en y√ºksek puanlarƒ± almƒ±≈ü filmleri √∂nerdi).

![Add Rows](/assets/azure-ml-recommend-add-rows.jpg)

Ye≈üil tikler dikkatinizi √ßekmi≈ütir, olu≈üturduƒüumuz **deney**i istediƒüimiz zaman alt tarafta yer alan **RUN** komutu ile √ßalƒ±≈ütƒ±rabiliriz. Hatta istersek t√ºm diyagram yerine sadece se√ßili bile≈üeni de √ßalƒ±≈ütƒ±rabiliyoruz.

![Run](/assets/azure-ml-recommend-run.jpg)

≈ûimdi bu biriktirdiƒüimiz verileri yorumlama zamanƒ±.

## Train Matchbox Recommender

[Train Matchbox Recommender](https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/train-matchbox-recommender) Microsoft tarafƒ±ndan geli≈ütirilmi≈ü, olasƒ±lƒ±ksal bir modele (Bayesian) dayanan b√ºy√ºk √∂l√ßekli bir √∂neri sistemidir. Bu model, bir kullanƒ±cƒ±nƒ±n tercihlerini film, i√ßerik veya diƒüer √ºr√ºnler gibi √∂geleri nasƒ±l derecelendirdikleri √ºzerine yapƒ±lan g√∂zlemlerle √∂ƒürenebilir. Bu g√∂zlemlere dayanarak, istendiƒüinde kullanƒ±cƒ±lara yeni √ºr√ºnler √∂nerir.

Kullanƒ±cƒ±lar tarafƒ±ndan verilmi≈ü puan bilgilerinin yanƒ±nda kullanƒ±cƒ±lar ve i√ßerikler hakkƒ±ndaki meta verileri de √∂ƒürendikleri arasƒ±na katabiliyor.

S√∂zl√ºk tanƒ±mƒ±nƒ± ge√ßersek, Microsoft, tavsiye sistemi geli≈ütirebilmemiz i√ßin bize var olan puan bilgilerinden √∂ƒürenebilen hazƒ±r bir bile≈üen sunuyor. Hemen deneyimize ekleyelim. Kullanƒ±cƒ± ve i√ßerik meta bilgilerimiz olmadƒ±ƒüƒ±ndan onlarƒ± e≈üle≈ütirmeden bƒ±rakƒ±yoruz.

![Train Matchbox Recommender](/assets/azure-ml-recommend-train.jpg)

**Train Matchbox Recommender** ile yapabileceƒüimiz ayarlar da a≈üaƒüƒ±daki gibi (bile≈üeni se√ßtiƒüimizde saƒü tarafta g√∂rebilirsiniz).

![Train Matchbox Recommender Options](/assets/azure-ml-recommend-train-options.jpg)

**Number of traits:** Kullanƒ±cƒ± meta verilerinden ka√ß tanesini √∂ƒürenirken kullanacaƒüƒ± bilgisi. Biz meta verileri kullanmadƒ±ƒüƒ±mƒ±z i√ßin varsayƒ±lan deƒüeri bƒ±rakabiliriz.

**Number of recommendation algorithm iterations:** Algoritmanƒ±n verileri ka√ß kez i≈üleyeceƒüi. Varsayƒ±lan deƒüer kalabilir.

**Number of training batches:** Algoritma verileri par√ßalara ayƒ±rarak paralelde √ßalƒ±≈ütƒ±rabiliyor. Bu deƒüer ile ka√ß grup olacaƒüƒ±nƒ± s√∂yl√ºyoruz, idealde i≈ülemcinin core sayƒ±sƒ± kadar girmeliyiz. Yine varsayƒ±lan deƒüer kalabilir.

Artƒ±k elimizdeki verileri √∂ƒürenmi≈ü bir sistemimiz var, sƒ±rada bildiklerine g√∂re yorum yapabilmesini saƒülamaya geldi.

## Score Matchbox Recommender

[Score Matchbox Recommender](https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/score-matchbox-recommender) √∂ƒürenilmi≈ü modeli kullanarak tahminler y√ºr√ºtebilen bir bile≈üen. Bu bile≈üen de kullanƒ±cƒ±lar ve i√ßerikler hakkƒ±ndaki meta verileri deƒüerlendirmeye alabiliyor. Biz yine bunlarƒ± bo≈ü ge√ßeceƒüiz, bize gerekenler eƒüittiƒüimiz tavsiyeci, tahmin y√ºr√ºtmesini istediƒüimiz veriler ve eƒüitim sƒ±rasƒ±nda kullandƒ±ƒüƒ±mƒ±z veri k√ºmesi.

![Score Matchbox Recommender](/assets/azure-ml-recommend-score.jpg)

*Score Matchbox Recommender* i√ßin yapabileceƒüimiz ayarlar ise a≈üaƒüƒ±daki gibi.

![Score Matchbox Recommender](/assets/azure-ml-recommend-score-options.jpg)

**Recommender prediction kind:** Puan tahmini, yakƒ±n kullanƒ±cƒ±lar ve yakƒ±n i√ßerikler se√ßenekleri de bulunan listeden biz i√ßerik tavsiyesi istediƒüimiz i√ßin *Item Recommendation* se√ßeneƒüini se√ßiyoruz (varsayƒ±lan se√ßenek).

**Recommender item selection:** Algoritmadan t√ºm se√ßenekler, puan verdiklerimiz (teyit etmek i√ßin) ya da puan vermediƒüimiz veriler (tavsiye i√ßin) i√ßin tahmin y√ºr√ºtmesini isteyebiliriz. **From Unrated Items** se√ßiyoruz.

**Maximum number of items to recommend to a user:** Ka√ß adet tavsiye istediƒüimiz. 5 deƒüeri kalabilir, daha fazla tavsiye istiyorsanƒ±z bu deƒüeri arttƒ±rabilirsiniz.

**Whether to return the predicted ratings of the items along with the labels:** Algoritmadan tahmin edilen i√ßeriklerin yanƒ±nda bizim vereceƒüimizi tahmin ettiƒüi puanƒ± da s√∂ylemesini isteyebiliyoruz. Se√ßmeden ge√ßtim.

Bir bakalƒ±m nasƒ±l tavsiyede bulunmu≈ü. Deneyimizi √ßalƒ±≈ütƒ±rƒ±p **Score Matchbox Recommender** bile≈üenine saƒü tƒ±klayarak **Score Dataset -> Visualize** ile sonucu g√∂rselle≈ütirelim.

![Score Matchbox Recommender Results](/assets/azure-ml-recommend-score-result.jpg)

5 adet tavsiyeyi g√∂rebiliyoruz. Ancak hepsi Film ID deƒüerleri. ƒ∞simleri √∂ƒürenmemiz lazƒ±m, bunun i√ßin de verileri yine Azure ML'in bize saƒüladƒ±ƒüƒ± **Movie Titles** bile≈üeni ile yapacaƒüƒ±z. Ancak bir sorun var, verileri **Join** ile birle≈ütirebilmek i√ßin yatayda yer alan bu 5 √∂neriyi dikeye √ßevirmemiz gerekiyor. Ben bu i≈ü i√ßin **Execute Python Script** bile≈üenini kullandƒ±m.

Script a≈üaƒüƒ±daki gibi:

```python
import pandas as pd

def azureml_main(dataframe1 = None, dataframe2 = None):
    values = [dataframe1[c] for c in dataframe1.columns[1:]]
    return pd.DataFrame(values)
```

Python bilenler i√ßin √ßok kolay olan kodumuzu yine de a√ßƒ±klayalƒ±m. Bile≈üenimize gelen ilk parametre olan **dataframe1** s√ºtunlarƒ±ndan ilki hari√ß (√ß√ºnk√º ilk alan UserId) her biri i√ßin veriyi alƒ±p bir diziye ekliyoruz, ve bu dizi ile yeni bir **[DataFrame](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html)** olu≈üturup d√∂n√ºyoruz.

![Python Script](/assets/azure-ml-recommend-python.jpg)

G√∂rselle≈ütirme ekranƒ±nƒ± a√ßtƒ±ƒüƒ±mƒ±zda kar≈üƒ±la≈ütƒ±ƒüƒ±mƒ±z sonu√ß ise a≈üaƒüƒ±daki gibi (tabii tavsiyeler bana √∂zel).

![Python Script Result](/assets/azure-ml-recommend-python-result.jpg)

Son i≈ülem olarak bu listeyi a≈üaƒüƒ±daki gibi **IMDB Movie Titles** bile≈üeni ile **Join Data** kullanarak birle≈ütiriyoruz. Deneyimizin son hali a≈üaƒüƒ±daki gibi.

![Join Data](/assets/azure-ml-recommend-join.jpg)

Tavsiyeleri ise **Join Data** g√∂rselle≈ütirerek g√∂rebiliriz.

![Join Data](/assets/azure-ml-recommend-join-result.jpg)

Sonunda tavsiyelerimi aldƒ±m, listeye bakƒ±nca izleyip √ßok sevdiƒüim ancak puan vermeyi unuttuƒüum **Lawrance of Arabia**, zaten izleme listemde olan **Witness for the Prosecution** yanƒ±nda b√ºy√ºk ihtimal seveceƒüim **The Class of 92**, **Paris, Texas**, **It's a Wonderful Life** gibi filmler yer alƒ±yor. Kesinlikle ba≈üarƒ±lƒ± tahminler üòä.

Mutlu kodlamalar!
